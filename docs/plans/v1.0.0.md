## Rush & Reaction v1.0.0 Implementation Plan (React + Vite + TypeScript)

### Summary
Build a mobile-first, responsive tile-sequence game in a new Vite React app with Tailwind CSS, using a reducer-driven finite state machine for deterministic gameplay (`menu -> countdown -> playing -> won/lost`).  
The implementation will prioritize clear game-state transitions, touch-friendly UX, and testable pure logic modules.

### Scope and Success Criteria
- Implement all gameplay and UI behaviors defined in [`/docs/requirements/v1.0.0.md`](/docs/requirements/v1.0.0.md).
- Support board sizes `3x3` through `8x8`.
- Enforce correct sequential tile click/tap logic with failure counting and timer penalty.
- Show modal lockout on win/loss with return-to-menu action.
- Work cleanly on desktop and mobile breakpoints.

### Implementation Architecture

### 1. Project Bootstrap
- Initialize Vite React TypeScript app in repo root.
- Add Tailwind CSS and minimal global styles for layout, spacing, and UI tokens.
- Add test stack:
  - `vitest` + `@testing-library/react` + `@testing-library/user-event`
  - optional `jsdom` setup file for DOM tests.

### 2. Folder Structure
- `src/app/App.tsx`: root composition.
- `src/game/types.ts`: shared types and enums.
- `src/game/constants.ts`: board sizes, colors, failure max, countdown seconds, penalty.
- `src/game/utils.ts`: pure logic helpers (grid generation, shuffling, timer format, tile sizing).
- `src/game/reducer.ts`: FSM reducer + action definitions.
- `src/game/selectors.ts`: derived view helpers.
- `src/components/MainMenu.tsx`
- `src/components/CountdownView.tsx`
- `src/components/GameHud.tsx` (timer + hearts)
- `src/components/GameBoard.tsx`
- `src/components/GameTile.tsx`
- `src/components/ResultModal.tsx`

### 3. State Model (Reducer FSM)
Use `useReducer` with strict discriminated union state.

- States:
  - `menu`
  - `countdown` (`boardSize`, `secondsRemaining`)
  - `playing` (`boardSize`, `tiles`, `expectedNumber`, `failures`, `elapsedMs`, `flashError`)
  - `result` (`won | lost`, final stats)
- Actions:
  - `SELECT_BOARD(size)`
  - `COUNTDOWN_TICK`
  - `START_GAME`
  - `TILE_PRESS(tileId)`
  - `CLEAR_ERROR_FLASH`
  - `TIMER_TICK(deltaMs)`
  - `RETURN_TO_MENU`
- Transition constraints:
  - Ignore `TILE_PRESS` unless in `playing`.
  - Wrong press: `failures + 1`, `elapsedMs + 2000`, `flashError = true`.
  - Loss when `failures >= 3`.
  - Win when `expectedNumber > totalTiles`.

### 4. Data and Gameplay Logic
- Tile generation on game start:
  - Create numbers `1..N`.
  - Shuffle once per round.
  - Assign border colors from required preset pool (cycled if needed).
- Correct click:
  - Accept only tile with value `expectedNumber`.
  - Mark tile as `isCorrectPressed = true` for visual feedback state.
  - Increment `expectedNumber`.
- Wrong click:
  - Increment failure and add timer penalty.
  - Trigger board red flash animation class; auto-clear after short timeout.
- Timer:
  - Starts at gameplay start (after countdown ends).
  - Update via `setInterval` (e.g., 100ms or 250ms), store as milliseconds.
  - Display as `mm:ss.SSS` (minutes, seconds, and milliseconds) consistently.
- Countdown:
  - Start at `3`.
  - During countdown, board is hidden and only countdown UI shows.
  - On zero, transition into `playing`.

### 5. UI/UX Details
- Main Menu:
  - Title + six board-size buttons (`3x3` to `8x8`).
- Playing Screen:
  - Top HUD with live timer and 3 hearts.
  - Hearts: solid red for remaining lives, outlined for spent lives.
  - Board centered with visible tile gaps.
  - Responsive tile sizing:
    - Mobile-first, square cells using CSS grid.
    - Keep tiles large enough for touch (target ~44px minimum).
- Feedback:
  - Tile pressed visual state (subtle background change).
  - Wrong click board border flashes red 1–2 pulses and the full flash animation must complete within `350ms`.
- Result Modal:
  - Overlay blocks interaction with underlying game.
  - Win and loss variants.
  - Win modal includes the player’s final completion time in `mm:ss.SSS`.
  - “Back to Main Menu” button dispatches reset action.
- Motion and transitions:
  - All major state transitions (`menu <-> countdown`, `countdown -> playing`, `playing -> result`) should use smooth ease-in-out effects.
  - Use short motion durations (approximately `200–350ms`) to avoid slowing gameplay interactions.

### Public Interfaces and Types
- `BoardSize`: `3 | 4 | 5 | 6 | 7 | 8`
- `GamePhase`: `'menu' | 'countdown' | 'playing' | 'result'`
- `Tile`:
  - `id: string`
  - `value: number`
  - `borderColor: string`
  - `isCorrectPressed: boolean`
- `GameState` discriminated union per phase.
- `GameAction` union for all reducer events.
- No external API/backend required in v1.0.0.

### Testing Plan

### Unit Tests (Pure Logic)
- `generateShuffledTiles(size)`:
  - outputs exactly `size*size` unique values from `1..N`.
- Reducer transitions:
  - menu -> countdown on board select.
  - countdown ticks to start game.
  - correct tile press advances `expectedNumber`.
  - wrong press increments failures and adds `2000ms`.
  - loss at exactly 3 failures.
  - win after final correct press.
- Heart display selector:
  - maps failure count to filled/outline heart count.

### Component/Integration Tests
- Main menu renders all size options.
- Countdown hides board and shows decreasing numbers.
- Playing UI shows timer + hearts + grid.
- Wrong tile press triggers error class and heart decrement.
- Modal appears on win/loss and traps progression until return button used.
- Win modal shows the final elapsed time text with milliseconds.
- Mobile viewport smoke test for board rendering (non-overflow and clickable tiles).
- Wrong-click border flash animation duration is at or under `350ms`.

### Acceptance Scenarios
- Player selects `3x3`, sees `3..2..1`, then game appears.
- Player makes one wrong tap:
  - heart state changes by one,
  - timer jumps by 2 seconds,
  - board flashes red briefly.
- Player reaches 3 failures before completion -> loss modal.
- Player completes full sequence -> win modal.
  - Win modal displays final consumed time with milliseconds.
- Returning from modal always lands on main menu.
- State transitions feel smooth with ease-in-out animation and no abrupt visual jumps.

### Performance and Reliability Guidelines
- Keep logic in pure reducer/util functions; UI components remain mostly presentational.
- Avoid unnecessary re-renders:
  - memoize derived board rows/selectors where useful,
  - keep interval effects narrowly scoped by phase.
- No heavy dependencies beyond core React + test/tooling.

### Assumptions and Defaults (Locked)
- Language: TypeScript.
- State architecture: `useReducer` finite-state model.
- Max failures: `3` (as requirement default).
- Timer penalty per wrong click: `+2s`.
- Countdown length: `3 seconds`.
- Timer display precision: minutes + seconds + milliseconds (`mm:ss.SSS`).
- Wrong-click border flash completion target: `<= 0.5s`.
- No persistence/leaderboard/audio in v1.0.0.
- Single-player local session only.
- Tailwind used for standard styling plus small custom CSS for animations.

### Delivery Sequence
1. Scaffold Vite + React + TypeScript + Tailwind + test tooling.
2. Implement core game types/constants/utils.
3. Implement reducer FSM and timer/countdown effects.
4. Build UI components and wire reducer actions.
5. Add animations/feedback states (tile active + board flash + modal overlay).
6. Add unit + integration tests.
7. Run lint/test/build verification and finalize.
